name: Sync to Public Repo

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Remove Private Files
        run: |
          rm -rf docs || true
          rm -f task.md || true
          rm -rf .system_generated || true
          rm -rf .agent || true
          echo "Private files removed."

      - name: Push to Public Repo
        env:
          PAT: ${{ secrets.API_TOKEN_GITHUB }}
        run: |
          # Remove .git and reinitialize for clean push
          rm -rf .git
          git init
          
          # Configure git AFTER init
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          
          git add -A
          git commit -m "Sync from internal repo"
          
          # Push using the token
          git remote add public https://${PAT}@github.com/TdoubleAV/TrailKin.git
          git branch -M master
          git push -f public master
